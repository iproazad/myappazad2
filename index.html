<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نظام إدارة القضايا</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Tajawal', 'sans-serif'],
            },
            colors: {
              'brand-blue': '#00A8E8',
              'brand-dark': '#1a202c',
              'brand-light': '#f7fafc',
            }
          },
        },
      }
    </script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
      /* Embedded Google Fonts to prevent CORS issues with html-to-image */
      /* arabic */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iura6YBwBO54cTaC66h0.woff2) format('woff2');
        unicode-range: U+0600-06FF, U+200C-200E, U+2010-2011, U+204F, U+2E41, U+FB50-FDFF, U+FE80-FEFC;
      }
      /* latin */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iura6YBwBO54cTaC66p0.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
      /* arabic */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iurb6YBwBO54cTaje7h04Z98.woff2) format('woff2');
        unicode-range: U+0600-06FF, U+200C-200E, U+2010-2011, U+204F, U+2E41, U+FB50-FDFF, U+FE80-FEFC;
      }
      /* latin */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iurb6YBwBO54cTaje7l04Q.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
      /* arabic */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iurb6YBwBO54cTa-e7h04Z98.woff2) format('woff2');
        unicode-range: U+0600-06FF, U+200C-200E, U+2010-2011, U+204F, U+2E41, U+FB50-FDFF, U+FE80-FEFC;
      }
      /* latin */
      @font-face {
        font-family: 'Tajawal';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/tajawal/v10/Iurb6YBwBO54cTa-e7l04Q.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      body {
        font-family: 'Tajawal', sans-serif;
      }
      @media print {
        body * {
          visibility: hidden;
        }
        #printable-area, #printable-area * {
          visibility: visible;
        }
        #printable-area {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
        }
      }
    </style>
    <!-- Use UMD builds of React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Add Babel for in-browser JSX/TSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-gray-800 text-gray-100">
    <div id="root"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    
    <!-- All application code is bundled here -->
    <script type="text/babel" data-presets="react,typescript">
      (() => {
        const { useState, useRef, useCallback, useEffect, useMemo, forwardRef, StrictMode } = React;

        // --- From types.ts ---
        
        // --- From hooks/useLocalStorage.ts ---
        function getStorageValue(key, defaultValue) {
          if (typeof window !== 'undefined') {
            const saved = localStorage.getItem(key);
            if (saved) {
              try {
                const initial = JSON.parse(saved);
                return initial;
              } catch (error) {
                console.error("Error parsing JSON from localStorage", error);
                return defaultValue;
              }
            }
          }
          return defaultValue;
        }

        const useLocalStorage = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            return getStorageValue(key, defaultValue);
          });

          useEffect(() => {
            localStorage.setItem(key, JSON.stringify(value));
          }, [key, value]);

          return [value, setValue];
        };

        // --- From components/Icons.tsx ---
        const IconWrapper = ({ children, className }) => <div className={`w-6 h-6 flex-shrink-0 text-blue-400 ${className}`}>{children}</div>;
        const DetailItem = ({ icon, label, value }) => (
            <div className="flex items-start gap-3">
                {icon}
                <div>
                    <p className="text-gray-400 text-xs">{label}</p>
                    <p className="font-semibold text-sm text-white">{value || '-'}</p>
                </div>
            </div>
        );

        const PoliceBadgeIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-3z"></path></svg>);
        const UserIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>);
        const CalendarIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h27" /></svg>);
        const MapPinIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg>);
        const PhoneIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" /></svg>);
        const UsersIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.663l.001.109m-8.375 5.065a4.125 4.125 0 01-7.533-2.493m3.75 2.493a4.125 4.125 0 013.75 0" /></svg>);
        const BriefcaseIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M20.25 14.15v4.07a2.25 2.25 0 01-2.25 2.25h-13.5a2.25 2.25 0 01-2.25-2.25v-4.07m18-4.22l-1.5-1.5a2.25 2.25 0 00-3.182 0l-1.5 1.5a2.25 2.25 0 01-3.182 0l-1.5-1.5a2.25 2.25 0 00-3.182 0l-1.5 1.5A2.25 2.25 0 005.25 6H10" /></svg>);
        const LockClosedIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>);
        const ClockIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);
        const BookmarkIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M3 3v1.5M3 21v-6m0 0l2.77-.693a9 9 0 016.208.682l.108.054a9 9 0 006.086.71l3.114-.732a48.524 48.524 0 01-.005-10.499l-3.11.732a9 9 0 01-6.085-.711l-.108-.054a9 9 0 00-6.208-.682L3 4.5M3 15V4.5" /></svg>);
        const HashtagIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M5.25 8.25h15m-16.5 7.5h15m-1.8-13.5l-3.9 19.5m-2.1-19.5l-3.9 19.5" /></svg>);

        const CameraIcon = ({ className }) => (
          <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
        );

        const PrintIcon = ({ className }) => (
          <svg className={className || "w-5 h-5"} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
          </svg>
        );

        const DownloadIcon = ({ className }) => (
          <svg className={className || "w-5 h-5"} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
        );

        const UserPlusIcon = ({ className }) => (
            <svg className={className || "w-5 h-5"} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
            </svg>
        );
        
        const WhatsAppIcon = ({ className }) => (
            <svg className={className || "w-5 h-5"} viewBox="0 0 24 24" fill="currentColor">
                <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.655 4.398 1.908 6.161l.111.169-1.125 4.105 4.216-1.105.16.096z" />
            </svg>
        );

        const TrashIcon = ({ className }) => (
            <svg className={className || "w-5 h-5"} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const SearchIcon = ({ className }) => (
            <svg className={className || "w-5 h-5"} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        // --- From components/Button.tsx ---
        const Button = ({ text, icon, className, ...props }) => {
          return (
            <button
              {...props}
              className={`inline-flex items-center justify-center px-6 py-2.5 text-base font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-800 transition-all duration-300 transform hover:scale-105 shadow-lg ${className}`}
            >
              {icon && <span className="me-2">{icon}</span>}
              {text}
            </button>
          );
        };
        
        // --- From components/InputField.tsx ---
        const InputField = ({ id, label, value, onChange, type = 'text', required = false, as = 'input', datalistOptions, placeholder, icon }) => {
          const commonClassName = "bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-colors duration-300";

          const commonProps = {
            id,
            name: id,
            value,
            onChange,
            required,
            placeholder,
          };

          const datalistId = datalistOptions ? `${id}-options` : undefined;

          const inputElement = as === 'textarea' ? (
            <textarea {...commonProps} rows={3} className={`${commonClassName} ${icon ? 'ps-10' : ''}`} />
          ) : (
            <>
              <input type={type} {...commonProps} list={datalistId} className={`${commonClassName} ${icon ? 'ps-10' : ''}`} />
              {datalistOptions && (
                <datalist id={datalistId}>
                  {datalistOptions.map(option => <option key={option} value={option} />)}
                </datalist>
              )}
            </>
          );

          return (
            <div className="flex flex-col">
              {label && <label htmlFor={id} className="mb-2 font-medium text-gray-300">{label}{required && <span className="text-red-500 ms-1">*</span>}</label>}
              <div className="relative">
                {icon && (
                  <div className="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-gray-400">
                    {icon}
                  </div>
                )}
                {inputElement}
              </div>
            </div>
          );
        };
        
        // --- From components/Header.tsx ---
        const Header = ({ currentPage, setCurrentPage }) => {
          const navLinkClasses = (page) =>
            `px-4 py-2 rounded-md text-sm sm:text-base font-medium transition-colors duration-300 ${
              currentPage === page
                ? 'bg-blue-600 text-white shadow-lg'
                : 'text-gray-300 hover:bg-gray-700 hover:text-white'
            }`;

          return (
            <header className="bg-gray-800 shadow-md">
              <nav className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex items-center justify-between h-16">
                  <div className="flex items-center">
                    <h1 className="text-xl sm:text-2xl font-bold text-white">نظام التسجيل</h1>
                  </div>
                  <div className="flex items-center space-x-4 rtl:space-x-reverse">
                    <button
                      onClick={() => setCurrentPage('suspect')}
                      className={navLinkClasses('suspect')}
                    >
                      توماركرنا تومەتباری
                    </button>
                    <button
                      onClick={() => setCurrentPage('incident')}
                      className={navLinkClasses('incident')}
                    >
                      توماری ئاریشە
                    </button>
                  </div>
                </div>
              </nav>
            </header>
          );
        };

        // --- From pages/SuspectPage.tsx ---
        const SuspectPage = () => {
            const emptySuspect = {
                photo: null, name: '', birthdate: '', address: '', problemType: '', maritalStatus: '',
                job: '', prison: '', phone: '', timeFrom: '', timeTo: '', period: 'روژ',
                problemLocation: '', driverName: '', point: '', sentTo: '',
            };
            const problemTypeOptions = ["ئاریشا خێزانی", "خازوك", "شـــەر", "سەرخوش", "رویدانا ترومبێلێ", "مخەدەر", "دزی", "بەرزەبون", "ازعــاج", "داخازكری", "گومانلێكری", "هەولا خوكوشتنێ", "خوكوشتن", "كوشتن", "گیان ژدەستدان", "بێ سەمیان", "كێشانا سكوتینێ", "فیلبازی تشقلە", "ترومبيلا بي خودان", "ئاگر بەربون", "تەقەكرن", "مەلەڤاني جهی قەدەغە", "تێكدەر", "خەندقین", "گەفكرن"];
            const driverNameOptions = ["سليمان علي حميد", "نیچیرڤان عباس بشار", "نعمان رمضان محمد", "رضوان محمود محمد", "داود قادر ندیر ناصر", "سربست محمدعلی", "حسن رؤوف حسن", "ريزان سمو محمد", "صابر شفیق شمزین", "رضوان رمضان علی", "سعید سربست رسول", "نیجیرڤان احمد علی", "دشتی عادل عثمان", "ریبر سلمان عثمان", "ازاد عدنان عبدالله", "بیوار اسماعیل محمد", "مهڤان تحسين پيراموس", "فارس بكر رشید"];
            const pointOptions = ["100", "101", "102", "103", "105", "106", "107", "108", "109", "110", "111", "112"];
            const sentToOptions = ["بنگەهێ پولیسێن كارێز", "بنگەهێ پولیسێن زاخو", "بنگەهێ پولیسێن سێمالكا", "بنگەهێ پولیسێن دەلال", "بنگەهێ پولیسێن بێدارێ", "بنگەهێ پولیسێن نیو زاخو", "بنگەهێ پولیسێن رزگاری", "رێڤەبەریا پولیسێن زاخو", "توندوتیژیا زاخو", "نەخوشخانا زاخو", "دەستێ سەمیانا", "مكافحا زاخو", "مكافحا بێدارێ", "ئاسايشا زاخو", "ئاگرڤەمراندنا زاخو", "گرتیخانا زاخو", "هاتوچووا زاخو"];

            const SuspectCard = forwardRef(({ suspect }, ref) => {
                const registrationDate = new Date(suspect.date);
                const formattedDate = registrationDate.toLocaleDateString('ar-IQ');
                const formattedTime = registrationDate.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit', hour12: true });
                return (
                    <div ref={ref} id="suspect-card-content" className="w-full max-w-4xl bg-gradient-to-br from-gray-900 to-black rounded-2xl shadow-2xl overflow-hidden font-sans text-white border border-blue-800/50">
                        <div className="bg-black/30 p-4 flex items-center justify-between border-b border-gray-700 backdrop-blur-sm">
                            <h2 className="text-xl sm:text-2xl font-bold text-blue-300 tracking-wider">بەشێ پولیسێن هەوارهاتنێ</h2>
                            <PoliceBadgeIcon className="w-10 h-10 text-blue-500" />
                        </div>

                        <div className="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="md:col-span-1 flex flex-col items-center text-center space-y-4">
                                <div className="w-48 h-56 rounded-lg border-4 border-blue-500/50 shadow-lg flex items-center justify-center overflow-hidden bg-gray-800">
                                    {suspect.photo ? <img src={suspect.photo} alt="صورة المتهم" className="w-full h-full object-cover" /> : <CameraIcon className="w-20 h-20 text-gray-500" />}
                                </div>
                                <div className="w-full bg-gray-800/50 p-3 rounded-lg border border-gray-700">
                                    <p className="text-gray-400 text-sm">ناڤێ تومەتباری</p>
                                    <p className="font-bold text-xl text-blue-100">{suspect.name}</p>
                                </div>
                            </div>

                            <div className="md:col-span-2 space-y-4">
                                <h3 className="text-lg font-semibold text-blue-400 border-b border-blue-500/30 pb-2">زانیاری کەسی</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <DetailItem icon={<IconWrapper><CalendarIcon /></IconWrapper>} label="ژدایـــكبون" value={suspect.birthdate} />
                                    <DetailItem icon={<IconWrapper><PhoneIcon /></IconWrapper>} label="ژمارا موبایلي" value={suspect.phone} />
                                    <DetailItem icon={<IconWrapper><MapPinIcon /></IconWrapper>} label="ئاكنجی بوون" value={suspect.address} />
                                    <DetailItem icon={<IconWrapper><UsersIcon /></IconWrapper>} label="بارێ خێزانی" value={suspect.maritalStatus} />
                                    <DetailItem icon={<IconWrapper><BriefcaseIcon /></IconWrapper>} label="كارێ وی" value={suspect.job} />
                                    <DetailItem icon={<IconWrapper><LockClosedIcon /></IconWrapper>} label="زیندانكرن" value={suspect.prison} />
                                </div>
                                <h3 className="text-lg font-semibold text-blue-400 border-b border-blue-500/30 pb-2 pt-4">پێزانینێن رویدانێ</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                     <DetailItem icon={<IconWrapper><ClockIcon /></IconWrapper>} label="الوقت" value={`${suspect.timeFrom || '-'} - ${suspect.timeTo || '-'}`} />
                                     <DetailItem icon={<IconWrapper className="text-yellow-400"><ClockIcon /></IconWrapper>} label="الفترة" value={suspect.period} />
                                     <DetailItem icon={<IconWrapper><UserIcon /></IconWrapper>} label="ناڤێ شوفێری" value={suspect.driverName} />
                                     <DetailItem icon={<IconWrapper><HashtagIcon /></IconWrapper>} label="خالا" value={suspect.point} />
                                     <div className="sm:col-span-2"><DetailItem icon={<IconWrapper><MapPinIcon /></IconWrapper>} label="جهێ ئاریشێ" value={suspect.problemLocation} /></div>
                                     <div className="bg-green-900/50 text-green-300 p-3 rounded-lg font-semibold flex items-start gap-3">
                                        <IconWrapper className="text-green-400"><BookmarkIcon /></IconWrapper>
                                        <div> <p className="text-green-200/80 text-xs">رەوانەكرن بـــو</p> <p>{suspect.sentTo || '-'}</p> </div>
                                     </div>
                                     <div className="bg-red-900/50 text-red-300 p-3 rounded-lg font-semibold flex items-start gap-3">
                                        <IconWrapper className="text-red-400"><BookmarkIcon /></IconWrapper>
                                        <div> <p className="text-red-200/80 text-xs">جورێ ئاریشێ</p> <p>{suspect.problemType || '-'}</p> </div>
                                     </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-black/30 p-3 text-center text-xs text-gray-400 border-t border-gray-700 flex items-center justify-center gap-2 backdrop-blur-sm">
                            <ClockIcon className="w-4 h-4" />
                            <span>مێژویا توماركرنا رویدانێ: {formattedDate} - {formattedTime}</span>
                        </div>
                    </div>
                );
            });

            const [suspects, setSuspects] = useLocalStorage('suspects', []);
            const [formData, setFormData] = useState(emptySuspect);
            const [generatedSuspect, setGeneratedSuspect] = useState(null);
            const cardRef = useRef(null);
            const topRef = useRef(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('date-desc');

            const handleDownload = useCallback((suspect) => {
                if (!cardRef.current) return;
                window.htmlToImage.toPng(cardRef.current, { quality: 1, pixelRatio: 3 })
                    .then((dataUrl) => {
                        const link = document.createElement('a');
                        link.download = `بطاقة-متهم-${suspect.name.replace(/ /g, '_')}.png`;
                        link.href = dataUrl;
                        link.click();
                    })
                    .catch((err) => console.error('oops, something went wrong!', err));
            }, []);
            
            const handleShare = async (suspect) => {
              if (!cardRef.current) return;
              const fileName = `بطاقة-متهم-${suspect.name.replace(/ /g, '_')}.png`;
              try {
                const dataUrl = await window.htmlToImage.toPng(cardRef.current, { quality: 1, pixelRatio: 2 });
                const res = await fetch(dataUrl);
                const blob = await res.blob();
                const file = new File([blob], fileName, { type: 'image/png' });

                if (navigator.share && navigator.canShare({ files: [file] })) {
                  await navigator.share({
                    title: 'بطاقة متهم',
                    text: `معلومات المتهم: ${suspect.name}`,
                    files: [file],
                  });
                } else {
                  alert('متصفحك لا يدعم المشاركة المباشرة. سيتم تحميل الصورة لتتمكن من مشاركتها يدويًا.');
                  handleDownload(suspect);
                }
              } catch (error) {
                console.error('Error sharing card:', error);
                alert('حدث خطأ أثناء محاولة مشاركة البطاقة.');
              }
            };

            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.id]: e.target.value }));

            const handlePhotoChange = (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (event) => setFormData(prev => ({ ...prev, photo: event.target?.result }));
                    reader.readAsDataURL(e.target.files[0]);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                const newSuspect = { id: Date.now().toString(), date: new Date().toISOString(), ...formData };
                setSuspects(prev => [newSuspect, ...prev]);
                setGeneratedSuspect(newSuspect);
                setFormData(emptySuspect);
                const fileInput = document.getElementById('photo-upload');
                if(fileInput) fileInput.value = "";
            };

            const handleSelectSuspect = (suspect) => {
                setGeneratedSuspect(suspect);
            };

            useEffect(() => {
                if (generatedSuspect) {
                    topRef.current?.scrollIntoView({ behavior: 'smooth' });
                }
            }, [generatedSuspect]);

            const filteredAndSortedSuspects = useMemo(() => {
                return suspects
                    .filter(s => s.name.toLowerCase().includes(searchTerm.toLowerCase()))
                    .sort((a, b) => {
                        switch (sortBy) {
                            case 'name-asc': return a.name.localeCompare(b.name, 'ar');
                            case 'name-desc': return b.name.localeCompare(a.name, 'ar');
                            case 'date-asc': return new Date(a.date).getTime() - new Date(b.date).getTime();
                            default: return new Date(b.date).getTime() - new Date(a.date).getTime();
                        }
                    });
            }, [suspects, searchTerm, sortBy]);

            return (
                <div className="space-y-8" ref={topRef}>
                    {generatedSuspect && (
                        <div className="bg-gray-800 p-6 rounded-lg shadow-xl flex flex-col items-center">
                            <h2 className="text-xl font-bold text-white mb-4">تم إنشاء البطاقة بنجاح</h2>
                            <SuspectCard ref={cardRef} suspect={generatedSuspect} />
                            <div className="mt-6 flex flex-wrap gap-4 justify-center">
                                <Button onClick={() => setGeneratedSuspect(null)} icon={<UserPlusIcon />} text="إضافة متهم جديد" className="bg-gray-600 hover:bg-gray-700 focus:ring-gray-800" />
                                <Button onClick={() => handleShare(generatedSuspect)} icon={<WhatsAppIcon className="w-5 h-5 text-white"/>} text="مشاركة" className="bg-green-600 hover:bg-green-700 focus:ring-green-800" />
                                <Button onClick={() => handleDownload(generatedSuspect)} icon={<DownloadIcon />} text="حفظ البطاقة" />
                            </div>
                        </div>
                    )}
                    
                    <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h2 className="text-2xl font-bold mb-6 text-blue-400 border-b-2 border-blue-500 pb-2">سجل جديد</h2>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="flex flex-col items-center gap-4">
                                <div className="w-40 h-40 bg-gray-700 rounded-full flex items-center justify-center overflow-hidden border-2 border-gray-500">
                                    {formData.photo ? <img src={formData.photo} alt="صورة المتهم" className="w-full h-full object-cover" /> : <CameraIcon className="w-16 h-16 text-gray-400" />}
                                </div>
                                <label htmlFor="photo-upload" className="cursor-pointer bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    <input id="photo-upload" type="file" className="hidden" onChange={handlePhotoChange} accept="image/*" />
                                    <span>{formData.photo ? "تغيير الصورة" : "التقاط أو تحميل صورة"}</span>
                                </label>
                            </div>
                            <div className="border-t border-gray-700 pt-4">
                                <h3 className="text-lg font-semibold text-gray-300 mb-4">زانیاری کەسی</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                   <InputField id="name" label="ناڤێ تومەتباری" value={formData.name} onChange={handleChange} required />
                                   <InputField id="birthdate" label="ژدایـــكبون" value={formData.birthdate} onChange={handleChange} />
                                   <InputField id="address" label="ئاكنجی بوون" value={formData.address} onChange={handleChange} />
                                   <InputField id="problemType" label="جورێ ئاریشێ" value={formData.problemType} onChange={handleChange} datalistOptions={problemTypeOptions} />
                                   <InputField id="maritalStatus" label="بارێ خێزانی" value={formData.maritalStatus} onChange={handleChange} datalistOptions={["خێزاندەرە", "نە خێزاندارە"]} />
                                   <InputField id="job" label="كارێ وی" value={formData.job} onChange={handleChange} />
                                   <InputField id="prison" label="زیندانكرن" value={formData.prison} onChange={handleChange} datalistOptions={["بەلی", "نەخێر"]} />
                                   <InputField id="phone" label="ژمارا موبایلي" value={formData.phone} onChange={handleChange} type="tel" />
                                </div>
                            </div>
                            <div className="border-t border-gray-700 pt-4">
                                <h3 className="text-lg font-semibold text-gray-300 mb-4">دەمژمێر</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <InputField id="timeFrom" label="من" value={formData.timeFrom} onChange={handleChange} type="time" />
                                    <InputField id="timeTo" label="إلى" value={formData.timeTo} onChange={handleChange} type="time" />
                                    <InputField id="period" label="الفترة" value={formData.period} onChange={handleChange} datalistOptions={["روژ", "شەڤ"]} />
                                </div>
                            </div>
                            <div className="border-t border-gray-700 pt-4">
                                <h3 className="text-lg font-semibold text-gray-300 mb-4">توماركرنا پێزانینێن رویدانێ</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                   <InputField id="problemLocation" label="جهێ ئاریشێ" value={formData.problemLocation} onChange={handleChange} />
                                   <InputField id="driverName" label="ناڤێ شوفێری" value={formData.driverName} onChange={handleChange} datalistOptions={driverNameOptions} />
                                   <InputField id="point" label="خالا" value={formData.point} onChange={handleChange} datalistOptions={pointOptions} />
                                   <InputField id="sentTo" label="رەوانەكرن بـــو" value={formData.sentTo} onChange={handleChange} datalistOptions={sentToOptions} />
                                </div>
                            </div>
                            <div className="text-center pt-4">
                                <Button type="submit" text="خەزنكرنا كارتێ" className="w-full md:w-auto" />
                            </div>
                        </form>
                    </div>

                    {suspects.length > 0 && (
                        <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                            <h2 className="text-2xl font-bold mb-4 text-blue-400">قائمة السجلات</h2>
                            <div className="flex flex-col sm:flex-row gap-4 mb-4">
                                <div className="flex-grow w-full sm:w-auto">
                                   <InputField id="search-suspects" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="بحث حسب اسم المتهم..." icon={<SearchIcon />} />
                                </div>
                                <div className="flex items-center gap-2 w-full sm:w-auto">
                                    <label htmlFor="sort-suspects" className="text-gray-300 whitespace-nowrap">ترتيب حسب:</label>
                                    <select id="sort-suspects" value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                        <option value="date-desc">الأحدث أولاً</option>
                                        <option value="date-asc">الأقدم أولاً</option>
                                        <option value="name-asc">الاسم (أ-ي)</option>
                                        <option value="name-desc">الاسم (ي-أ)</option>
                                    </select>
                                </div>
                            </div>
                            <ul className="space-y-3 max-h-96 overflow-y-auto">
                                {filteredAndSortedSuspects.map(s => (
                                    <li key={s.id} onClick={() => handleSelectSuspect(s)} className="bg-gray-700 p-4 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-600 transition-colors">
                                        <div className="flex items-center gap-4">
                                            <div className="w-12 h-12 bg-gray-600 rounded-full flex-shrink-0 overflow-hidden">
                                                {s.photo && <img src={s.photo} alt={s.name} className="w-full h-full object-cover" />}
                                            </div>
                                            <div>
                                                <p className="font-semibold">{s.name}</p>
                                                <p className="text-sm text-gray-400">{s.problemType}</p>
                                            </div>
                                        </div>
                                        <span className="text-xs text-gray-500">{new Date(s.date).toLocaleDateString('ar-IQ')}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };
        
        // --- From pages/IncidentPage.tsx ---
        const IncidentPage = () => {
            const emptyCaseInfo = {
                issueType: '', timeFrom: '', timeTo: '', period: 'روژ',
                location: '', driverName: '', point: '', sentTo: '',
            };
            const issueTypeOptions = ["ئاریشا خێزانی", "خازوك", "شـــەر", "سەرخوش", "رویدانا ترومبێلێ", "مخەدەر", "دزی", "بەرزەبون", "ازعــاج", "داخازكری", "گومانلێكری", "هەولا خوكوشتنێ", "خوكوشتن", "كوشتن", "گیان ژدەستدان", "بێ سەمیان", "كێشانا سكوتینێ", "فیلبازی تشقلە", "ترومبيلا بي خودان", "ئاگر بەربون", "تەقەكرن", "مەلەڤاني جهی قەدەغە", "تێكدەر", "خەندقین", "گەفكرن"];
            const driverNameOptions = ["سليمان علي حميد", "نیچیرڤان عباس بشار", "نعمان رمضان محمد", "رضوان محمود محمد", "داود قادر ندیر ناصر", "سربست محمدعلی", "حسن رؤوف حسن", "ريزان سمو محمد", "صابر شفیق شمزین", "رضوان رمضان علی", "سعید سربست رسول", "نیجیرڤان احمد علی", "دشتی عادل عثمان", "ریبر سلمان عثمان", "ازاد عدنان عبدالله", "بیوار اسماعیل محمد", "مهڤان تحسين پيراموس", "فارس بكر رشید"];
            const pointOptions = ["100", "101", "102", "103", "105", "106", "107", "108", "109", "110", "111", "112"];
            const sentToOptions = ["بنگەهێ پولیسێن كارێز", "بنگەهێ پولیسێن زاخو", "بنگەهێ پولیسێن سێمالكا", "بنگەهێ پولیسێن دەلال", "بنگەهێ پولیسێن بێدارێ", "بنگەهێ پولیسێن نیو زاخو", "بنگەهێ پولیسێن رزگاری", "رێڤەبەریا پولیسێن زاخو", "توندوتیژیا زاخو", "نەخوشخانا زاخو", "دەستێ سەمیانا", "مكافحا زاخو", "مكافحا بێدارێ", "ئاسايشا زاخو", "ئاگرڤەمراندنا زاخو", "گرتیخانا زاخو", "هاتوچووا زاخو"];

            const IncidentCard = forwardRef(({ incident }, ref) => {
                const timestamp = new Date(incident.date).toLocaleString('ar-IQ');
                return (
                    <div ref={ref} className="w-full max-w-6xl bg-gradient-to-br from-gray-900 to-black rounded-2xl shadow-2xl overflow-hidden font-sans text-white border border-blue-800/50">
                        <div className="bg-black/30 p-4 flex items-center justify-between border-b border-gray-700 backdrop-blur-sm">
                            <h2 className="text-2xl sm:text-3xl font-bold text-blue-300 text-center w-full">توماری ئاریشە</h2>
                        </div>
                        
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-0 lg:gap-6">
                            {/* Left side: Case info */}
                            <div className="lg:col-span-4 bg-gray-800/50 p-6 border-b lg:border-b-0 lg:border-r border-gray-700">
                                <h3 className="text-xl font-bold text-blue-400 mb-4 pb-2 border-b border-blue-500/30">پێزانینێن رویدانێ</h3>
                                <div className="space-y-4 text-sm">
                                    <DetailItem icon={<IconWrapper><BookmarkIcon /></IconWrapper>} label="جورێ ئاریشێ" value={incident.caseInfo.issueType} />
                                    <DetailItem icon={<IconWrapper><UserIcon /></IconWrapper>} label="ناڤێ شوفێری" value={incident.caseInfo.driverName} />
                                    <DetailItem icon={<IconWrapper><MapPinIcon /></IconWrapper>} label="جهێ ئاریشێ" value={incident.caseInfo.location} />
                                    <DetailItem icon={<IconWrapper><HashtagIcon /></IconWrapper>} label="خالا" value={incident.caseInfo.point} />
                                    <DetailItem icon={<IconWrapper><ClockIcon /></IconWrapper>} label="دەمژمێر" value={`${incident.caseInfo.timeFrom || '-'} - ${incident.caseInfo.timeTo || '-'} (${incident.caseInfo.period})`} />
                                    <div className="bg-green-900/50 text-green-300 p-3 rounded-lg font-semibold flex items-start gap-3 mt-2">
                                         <IconWrapper className="text-green-400"><BookmarkIcon /></IconWrapper>
                                        <div><p className="text-green-200/80 text-xs">رەوانەكرن بـــو</p><p>{incident.caseInfo.sentTo}</p></div>
                                    </div>
                                </div>
                            </div>

                            {/* Right side: Persons */}
                            <div className="lg:col-span-8 p-6">
                                 <h3 className="text-xl font-bold text-blue-400 mb-4 pb-2 border-b border-blue-500/30">کەسێن تێدا</h3>
                                <div className="space-y-4">
                                    {incident.persons.map((person) => (
                                        <div key={person.id} className="bg-gray-800/70 p-4 rounded-xl shadow-lg flex flex-col sm:flex-row gap-4 items-center sm:items-start relative overflow-hidden border border-gray-700">
                                            <span className={`absolute top-0 right-0 px-4 py-1 text-xs font-bold text-white rounded-bl-lg ${person.type === 'تاوانبار' ? 'bg-red-600' : 'bg-green-600'}`}>{person.type}</span>
                                            <div className="flex-shrink-0">
                                                <div className="w-28 h-36 rounded-lg border-4 border-blue-500/30 shadow-lg flex items-center justify-center overflow-hidden bg-gray-700">
                                                    {person.photo ? <img src={person.photo} alt={person.name} className="w-full h-full object-cover" /> : <CameraIcon className="w-12 h-12 text-gray-500" />}
                                                </div>
                                            </div>
                                            <div className="flex-1 w-full text-sm space-y-2 pt-4 sm:pt-0">
                                                <div className="flex items-center gap-3">
                                                    <IconWrapper><UserIcon /></IconWrapper>
                                                    <div>
                                                        <p className="text-gray-400 text-xs">ناڤ</p>
                                                        <p className="font-bold text-base text-white">{person.name}</p>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-2 pt-2 border-t border-gray-700/50">
                                                    <DetailItem icon={<IconWrapper><CalendarIcon /></IconWrapper>} label="ژدایـــكبون" value={person.birthdate} />
                                                    <DetailItem icon={<IconWrapper><PhoneIcon /></IconWrapper>} label="موبایل" value={person.phone} />
                                                    <div className="md:col-span-2">
                                                      <DetailItem icon={<IconWrapper><MapPinIcon /></IconWrapper>} label="ئاكنجی بوون" value={person.address} />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-black/30 p-3 text-center text-xs text-gray-400 border-t border-gray-700 flex items-center justify-center gap-2 backdrop-blur-sm">
                           <ClockIcon className="w-4 h-4" />
                           <span>تم إنشاء هذه البطاقة في: {timestamp}</span>
                        </div>
                    </div>
                );
            });

            const [incidents, setIncidents] = useLocalStorage('incidents', []);
            const [caseInfo, setCaseInfo] = useState(emptyCaseInfo);
            const [persons, setPersons] = useState([]);
            const [generatedIncident, setGeneratedIncident] = useState(null);
            const cardRef = useRef(null);
            const topRef = useRef(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('date-desc');

            const handleDownload = useCallback((incident) => {
                if (!cardRef.current) return;
                window.htmlToImage.toPng(cardRef.current, { quality: 1, pixelRatio: 3 })
                    .then((dataUrl) => {
                        const link = document.createElement('a');
                        link.download = `قضية-${incident.caseInfo.issueType.replace(/ /g, '_')}.png`;
                        link.href = dataUrl;
                        link.click();
                    })
                    .catch((err) => console.error('oops, something went wrong!', err));
            }, []);
            
             const handleShare = async (incident) => {
              if (!cardRef.current) return;
              const fileName = `قضية-${incident.caseInfo.issueType.replace(/ /g, '_')}.png`;
              try {
                const dataUrl = await window.htmlToImage.toPng(cardRef.current, { quality: 1, pixelRatio: 2 });
                const res = await fetch(dataUrl);
                const blob = await res.blob();
                const file = new File([blob], fileName, { type: 'image/png' });

                if (navigator.share && navigator.canShare({ files: [file] })) {
                  await navigator.share({
                    title: 'بطاقة قضية',
                    text: `تفاصيل قضية: ${incident.caseInfo.issueType}`,
                    files: [file],
                  });
                } else {
                  alert('متصفحك لا يدعم المشاركة المباشرة. سيتم تحميل الصورة لتتمكن من مشاركتها يدويًا.');
                  handleDownload(incident);
                }
              } catch (error) {
                console.error('Error sharing card:', error);
                alert('حدث خطأ أثناء محاولة مشاركة البطاقة.');
              }
            };

            const handleCaseInfoChange = (e) => setCaseInfo(prev => ({ ...prev, [e.target.id]: e.target.value }));
            const handlePersonChange = (index, field, value) => setPersons(persons.map((p, i) => i === index ? { ...p, [field]: value } : p));
            const handlePhotoChange = (index, e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (event) => handlePersonChange(index, 'photo', event.target?.result);
                    reader.readAsDataURL(e.target.files[0]);
                }
            };
            const addPerson = () => setPersons([...persons, { id: Date.now().toString(), name: '', type: '', birthdate: '', address: '', phone: '', photo: null }]);
            const removePerson = (index) => setPersons(persons.filter((_, i) => i !== index));

            const handleSubmit = (e) => {
                e.preventDefault();
                if (persons.length === 0) return alert('يجب إضافة شخص واحد على الأقل.');
                const newIncident = { id: Date.now().toString(), date: new Date().toISOString(), caseInfo, persons };
                setIncidents(prev => [newIncident, ...prev]);
                setGeneratedIncident(newIncident);
                setCaseInfo(emptyCaseInfo);
                setPersons([]);
            };

            const handleSelectIncident = (incident) => {
                setGeneratedIncident(incident);
            };

            useEffect(() => {
                if (generatedIncident) {
                    topRef.current?.scrollIntoView({ behavior: 'smooth' });
                }
            }, [generatedIncident]);

            const filteredAndSortedIncidents = useMemo(() => {
                return incidents
                    .filter(i => i.caseInfo.issueType.toLowerCase().includes(searchTerm.toLowerCase()))
                    .sort((a, b) => {
                        switch (sortBy) {
                            case 'type-asc': return a.caseInfo.issueType.localeCompare(b.caseInfo.issueType, 'ar');
                            case 'type-desc': return b.caseInfo.issueType.localeCompare(a.caseInfo.issueType, 'ar');
                            case 'date-asc': return new Date(a.date).getTime() - new Date(b.date).getTime();
                            default: return new Date(b.date).getTime() - new Date(a.date).getTime();
                        }
                    });
            }, [incidents, searchTerm, sortBy]);

            return (
                <div className="space-y-8" ref={topRef}>
                    {generatedIncident && (
                        <div className="bg-gray-800 p-6 rounded-lg shadow-xl flex flex-col items-center">
                            <h2 className="text-xl font-bold text-white mb-4">تم إنشاء بطاقة القضية بنجاح</h2>
                            <IncidentCard ref={cardRef} incident={generatedIncident} />
                            <div className="mt-6 flex flex-wrap gap-4 justify-center">
                                <Button onClick={() => setGeneratedIncident(null)} icon={<UserPlusIcon />} text="إضافة قضية جديدة" className="bg-gray-600 hover:bg-gray-700 focus:ring-gray-800" />
                                <Button onClick={() => handleShare(generatedIncident)} icon={<WhatsAppIcon className="w-5 h-5 text-white"/>} text="مشاركة" className="bg-green-600 hover:bg-green-700 focus:ring-green-800" />
                                <Button onClick={() => handleDownload(generatedIncident)} icon={<DownloadIcon />} text="حفظ البطاقة" />
                            </div>
                        </div>
                    )}
                    <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h2 className="text-2xl font-bold mb-6 text-blue-400 border-b-2 border-blue-500 pb-2">تسجيل قضية جديدة</h2>
                        <form onSubmit={handleSubmit} className="space-y-8">
                            <div className="space-y-6">
                                {persons.map((person, index) => (
                                    <div key={person.id} className="bg-gray-700 p-4 rounded-lg relative">
                                        <span className="absolute -top-3 -right-3 bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold border-4 border-gray-800">{index + 1}</span>
                                        <button type="button" onClick={() => removePerson(index)} className="absolute -top-2 -left-2 bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-red-700"><TrashIcon /></button>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div className="flex flex-col items-center justify-center gap-2">
                                                <div className="w-32 h-32 bg-gray-600 rounded-full overflow-hidden flex items-center justify-center">
                                                    {person.photo ? <img src={person.photo} alt={person.name} className="w-full h-full object-cover" /> : <CameraIcon className="w-12 h-12 text-gray-400"/>}
                                                </div>
                                                <label className="text-sm text-blue-400 cursor-pointer">
                                                    <input type="file" className="hidden" accept="image/*" onChange={(e) => handlePhotoChange(index, e)} />
                                                    {person.photo ? "تغيير الصورة" : "تحميل صورة"}
                                                </label>
                                            </div>
                                            <div className="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                <InputField id={`p-name-${index}`} label="ناڤێ تومەتباری" value={person.name} onChange={(e) => handlePersonChange(index, 'name', e.target.value)} required />
                                                <div>
                                                  <label htmlFor={`p-type-${index}`} className="mb-2 block font-medium text-gray-300">نوع الشخص</label>
                                                  <select id={`p-type-${index}`} value={person.type} onChange={(e) => handlePersonChange(index, 'type', e.target.value)} className="bg-gray-600 border border-gray-500 text-white text-sm rounded-lg block w-full p-2.5" required>
                                                      <option value="" disabled>اختر النوع</option>
                                                      <option value="مشتەكی">مشتەكی</option>
                                                      <option value="تاوانبار">تاوانبار</option>
                                                  </select>
                                                </div>
                                                <InputField id={`p-birthdate-${index}`} label="ژدایـــكبون" value={person.birthdate} onChange={(e) => handlePersonChange(index, 'birthdate', e.target.value)} />
                                                <InputField id={`p-phone-${index}`} label="ژمارا موبایلی" value={person.phone} onChange={(e) => handlePersonChange(index, 'phone', e.target.value)} type="tel" />
                                                <div className="sm:col-span-2">
                                                    <InputField id={`p-address-${index}`} label="ئاكنجی بوون" value={person.address} onChange={(e) => handlePersonChange(index, 'address', e.target.value)} />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                <div className="text-center"><Button type="button" text="إضافة شخص آخر" icon={<UserPlusIcon />} onClick={addPerson} /></div>
                            </div>
                            <div className="border-t-2 border-dashed border-blue-500 pt-6">
                                <h3 className="text-xl font-bold text-center mb-6 text-gray-300">معلومات القضية</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField id="issueType" label="جورێ ئاریشێ" value={caseInfo.issueType} onChange={handleCaseInfoChange} required datalistOptions={issueTypeOptions}/>
                                    <InputField id="location" label="جهێ ئاریشێ" value={caseInfo.location} onChange={handleCaseInfoChange} required/>
                                    <InputField id="driverName" label="ناڤێ شوفێری" value={caseInfo.driverName} onChange={handleCaseInfoChange} required datalistOptions={driverNameOptions} />
                                    <InputField id="point" label="خالا" value={caseInfo.point} onChange={handleCaseInfoChange} required datalistOptions={pointOptions} />
                                    <div className="md:col-span-2 grid grid-cols-3 gap-4">
                                        <InputField id="timeFrom" label="من" value={caseInfo.timeFrom} onChange={handleCaseInfoChange} type="time" />
                                        <InputField id="timeTo" label="إلى" value={caseInfo.timeTo} onChange={handleCaseInfoChange} type="time" />
                                        <InputField id="period" label="الفترة" value={caseInfo.period} onChange={handleCaseInfoChange} datalistOptions={["روژ", "شەڤ"]} />
                                    </div>
                                    <div className="md:col-span-2">
                                        <InputField id="sentTo" label="رەوانەكرن بـــو" value={caseInfo.sentTo} onChange={handleCaseInfoChange} datalistOptions={sentToOptions} />
                                    </div>
                                </div>
                            </div>
                            <div className="text-center pt-4"><Button type="submit" text="خەزنكرنا كارتێ" className="w-full md:w-auto" /></div>
                        </form>
                    </div>

                    {incidents.length > 0 && (
                        <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                            <h2 className="text-2xl font-bold mb-4 text-blue-400">القضايا المسجلة</h2>
                            <div className="flex flex-col sm:flex-row gap-4 mb-4">
                                <div className="flex-grow w-full sm:w-auto">
                                   <InputField id="search-incidents" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="بحث حسب نوع القضية..." icon={<SearchIcon />} />
                                </div>
                                <div className="flex items-center gap-2 w-full sm:w-auto">
                                    <label htmlFor="sort-incidents" className="text-gray-300 whitespace-nowrap">ترتيب حسب:</label>
                                    <select id="sort-incidents" value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                                        <option value="date-desc">الأحدث أولاً</option>
                                        <option value="date-asc">الأقدم أولاً</option>
                                        <option value="type-asc">نوع القضية (أ-ي)</option>
                                        <option value="type-desc">نوع القضية (ي-أ)</option>
                                    </select>
                                </div>
                            </div>
                            <ul className="space-y-3 max-h-96 overflow-y-auto">
                                {filteredAndSortedIncidents.map(i => (
                                    <li key={i.id} onClick={() => handleSelectIncident(i)} className="bg-gray-700 p-4 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-600 transition-colors">
                                        <div>
                                            <p className="font-semibold">{i.caseInfo.issueType}</p>
                                            <p className="text-sm text-gray-400">الأشخاص: {i.persons.length}</p>
                                        </div>
                                        <span className="text-xs text-gray-500">{new Date(i.date).toLocaleDateString('ar-IQ')}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };
        
        // --- From App.tsx ---
        const App = () => {
          const [currentPage, setCurrentPage] = useState('suspect');

          return (
            <div className="min-h-screen bg-gray-900 text-gray-100 font-sans">
              <Header currentPage={currentPage} setCurrentPage={setCurrentPage} />
              <main className="p-4 sm:p-6 md:p-8 max-w-7xl mx-auto">
                {currentPage === 'suspect' && <SuspectPage />}
                {currentPage === 'incident' && <IncidentPage />}
              </main>
              <footer className="text-center p-4 text-gray-500 text-sm">
                نظام إدارة القضايا - تم إنشاؤه بواسطة مهندس frontend خبير
              </footer>
            </div>
          );
        };
        
        // --- From index.tsx ---
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <StrictMode>
            <App />
          </StrictMode>
        );

      })();
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>